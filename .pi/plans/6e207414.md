{
  "id": "6e207414",
  "title": "Integration Testing — Full Flow Verification",
  "status": "draft",
  "created_at": "2026-02-22T03:35:03.639Z",
  "assigned_to_session": "b1bce40d-cce8-4adb-bbf6-73e96e72fda9",
  "steps": [
    {
      "id": 1,
      "text": "Step 1: Hypivisor integration tests — add tokio-tungstenite, write tests for WS connect/init, register/broadcast, auth rejection, disconnect→offline, multi-client broadcast, ping RPC",
      "done": true
    },
    {
      "id": 2,
      "text": "Step 2: Cross-component smoke test — Node.js script that starts hypivisor binary, simulates pi-socket registration, simulates Pi-DE receiving node_joined, verifies full event flow",
      "done": false
    },
    {
      "id": 3,
      "text": "Step 3: pi-socket integration tests — mock ExtensionAPI, verify WS server starts, clients receive init_state, messages forwarded to pi.sendUserMessage, events broadcast to all clients",
      "done": false
    },
    {
      "id": 4,
      "text": "Step 4: Pi-DE hook integration tests — mock WS servers, test useHypivisor reconnect + event handling, test useAgent init_state parsing + delta accumulation",
      "done": false
    },
    {
      "id": 5,
      "text": "Step 5: Verify all tests pass, commit",
      "done": false
    }
  ]
}

End-to-end integration tests verifying all 3 components work together.

## Strategy
1. **Hypivisor integration tests** (Rust) — real Axum server, real WebSocket clients
2. **Cross-component smoke test** (Node.js) — spawn hypivisor binary, simulate pi-socket + Pi-DE flows
3. **pi-socket integration tests** (Node.js) — mock pi ExtensionAPI, verify WebSocket server + event broadcasting
4. **Pi-DE hook tests** — verify useHypivisor and useAgent against mock WebSocket servers
