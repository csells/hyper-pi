{
  "id": "2e6baf29",
  "title": "Fix 3 issues: logging, connection drops, WebSocket proxy",
  "status": "completed",
  "created_at": "2026-02-22T16:18:32.893Z",
  "steps": [
    {
      "id": 1,
      "text": "Step 1: Fix pi-socket logging — delete log.ts, remove all console output, make extension completely silent",
      "done": true
    },
    {
      "id": 2,
      "text": "Step 2: Fix connection drops — fix Ping/Pong race (write to shared mutex stream), use single shared FrameCodec, fix useAgent hostname to localhost",
      "done": true
    },
    {
      "id": 3,
      "text": "Step 3: Add WebSocket proxy to hypivisor — /ws/agent/{nodeId} path proxies to agent's local WS port",
      "done": true
    },
    {
      "id": 4,
      "text": "Step 4: Update Pi-DE useAgent to connect through hypivisor proxy instead of direct agent ports",
      "done": true
    },
    {
      "id": 5,
      "text": "Step 5: Build, test, verify all 3 fixes work end-to-end",
      "done": true
    }
  ]
}

## Reviewer Consensus (Claude, Codex, Gemini)\n\n### Issue 1: Logging\n- log.ts uses console.* which goes to pi TUI\n- line 29 still has log.info() call\n- Fix: delete log.ts entirely, remove all log imports/calls\n\n### Issue 2: Connection Drops\nAll 3 reviewers identified the same bugs:\n1. **Ping/Pong race**: ws_recv writes pong directly to read_stream while broadcast thread writes to write_stream — concurrent writes corrupt frames\n2. **Multiple FrameCodec instances**: each write creates fresh FrameCodec::server() — should share one\n3. **Hostname resolution**: useAgent connects to raw hostname (.local) which browsers can't resolve\n\n### Issue 3: WebSocket Proxy\nAll 3 agree: hypivisor should proxy agent connections via /ws/agent/{nodeId}\n- Look up node in registry, connect to agent's local port\n- Bidirectional frame relay\n- Pi-DE only needs hypivisor port exposed"
